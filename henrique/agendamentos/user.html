<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Senac • Agendamentos</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
body{background:#f4f7fb;color:#111;min-height:100vh;position:relative}
.app{display:grid;grid-template-columns:260px 1fr;gap:20px;max-width:1200px;margin:28px auto;padding:20px}
.sidebar{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(36,59,85,0.06)}
.brand{font-weight:700;font-size:18px;margin-bottom:12px}
.cargo{color:#666;font-size:14px;margin-bottom:8px}
.menu{display:flex;flex-direction:column;gap:8px;margin-top:16px}
.menu button{background:transparent;border:0;padding:10px;text-align:left;border-radius:8px;cursor:pointer;font-size:14px;transition:.2s}
.menu button:hover{background:#eef6ff}
.menu button.active{background:#eef6ff;font-weight:600;color:#0b63d9}
header.topbar{display:flex;justify-content:space-between;align-items:center}
.muted{color:#556;font-size:14px}
.panel{background:#fff;padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(33,50,80,.05)}
.grid-salas{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:12px}
.sala-card{background:#fff;border:1px solid #e4e8ee;border-radius:10px;padding:16px;text-align:center;cursor:pointer;transition:.2s}
.sala-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}
.sala-card h3{font-size:16px;margin-bottom:6px;color:#0b63d9}
.sala-card p{font-size:13px;color:#444;margin-bottom:4px}
.form-agendamento{margin-top:16px;display:flex;flex-direction:column;gap:10px;max-width:300px}
input,select{padding:8px;border:1px solid #ccc;border-radius:6px;font-size:14px}
button{cursor:pointer;font-size:14px;border-radius:8px}
.btn-primary{background:#0b63d9;color:#fff;border:none;padding:8px 12px}
.btn-primary:hover{background:#084fab}
.toast{position:fixed;top:20px;right:20px;padding:12px 18px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15);z-index:9999;color:#111;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
.toast.success{background:#cce5ff}
.toast.error{background:#f8d7da}
</style>
</head>
<body>
<div class="app">
<aside class="sidebar">
<div class="brand">Senac • Agendamentos</div>
<div class="cargo" id="user-role">Usuário</div>
<div class="menu">
<button id="btn-salas" class="active">Salas</button>
<button id="btn-agendamentos">Meus agendamentos</button>
<button id="btn-conta">Minha conta</button>
</div>
</aside>
<main class="main">
<header class="topbar">
<div>
<h2 id="titulo-pagina">Salas disponíveis</h2>
<div class="muted" id="descricao-pagina">Aqui você pode ver e agendar as salas disponíveis.</div>
</div>
<button class="btn-primary" id="logout-btn">Sair</button>
</header>
<section id="content"></section>
</main>
</div>
<div class="toast" id="toast"></div>
<script>
const content=document.getElementById('content'),
      toast=document.getElementById('toast'),
      titulo=document.getElementById('titulo-pagina'),
      descricao=document.getElementById('descricao-pagina'),
      btnSalas=document.getElementById('btn-salas'),
      btnAgend=document.getElementById('btn-agendamentos'),
      btnConta=document.getElementById('btn-conta'),
      logoutBtn=document.getElementById('logout-btn'),
      loggedUser=JSON.parse(sessionStorage.getItem('loggedUser'));

if(!loggedUser){
    toast.textContent='Você precisa fazer login.';
    toast.className='toast show error';
    setTimeout(()=>window.location.href='index.html',1000);
}

let salas=JSON.parse(localStorage.getItem('salas'))||[];
let agendamentos=JSON.parse(localStorage.getItem('agendamentos'))||[];

function showToast(msg,type='success'){
    toast.textContent=msg;
    toast.className='toast show '+type;
    setTimeout(()=>toast.classList.remove('show'),2500);
}

function atualizarMenu(ativo){
    document.querySelectorAll('.menu button').forEach(btn=>btn.classList.remove('active'));
    ativo.classList.add('active');
}

function mostrarSalas(){
    titulo.textContent='Salas disponíveis';
    descricao.textContent='Aqui você pode ver e agendar as salas disponíveis.';
    content.innerHTML=`<div class="grid-salas">${salas.map((s,i)=>`
        <div class="sala-card" data-index="${i}">
            <h3>Sala ${s.numero}</h3>
            <p>Função: ${s.funcao}</p>
            <p>Piso: ${s.piso}</p>
        </div>`).join('')}</div>`;
    document.querySelectorAll('.sala-card').forEach(card=>{
        card.addEventListener('click',e=>mostrarDetalhesSala(salas[e.currentTarget.dataset.index]));
    });
}

function mostrarDetalhesSala(sala){
    titulo.textContent=`Sala ${sala.numero}`;
    descricao.textContent='Veja as informações e agende um horário.';
    const hoje=new Date().toISOString().split('T')[0];
    content.innerHTML=`<div class="panel">
        <p><strong>Função:</strong> ${sala.funcao}</p>
        <p><strong>Piso:</strong> ${sala.piso}</p>
        <form class="form-agendamento" id="form-agendar">
            <label>Data:</label><input type="date" id="data" min="${hoje}" required>
            <label>Horário de início:</label><input type="time" id="inicio" required>
            <label>Horário de término:</label><input type="time" id="fim" required>
            <button type="submit" class="btn-primary">Confirmar agendamento</button>
        </form>
    </div>`;
    document.getElementById('form-agendar').addEventListener('submit',e=>{
        e.preventDefault();
        const data=document.getElementById('data').value,
              inicio=document.getElementById('inicio').value,
              fim=document.getElementById('fim').value;
        if(!data||!inicio||!fim){
            showToast('Preencha todos os campos.','error');
            return;
        }
        const conflito=agendamentos.some(a=>a.numero===sala.numero&&a.data===data&&((inicio>=a.inicio&&inicio<a.fim)||(fim>a.inicio&&fim<=a.fim)));
        if(conflito){
            showToast('Já existe agendamento nesse horário.','error');
            return;
        }
        agendamentos.push({usuario:loggedUser.name,numero:sala.numero,data,inicio,fim,status:'pendente'});
        localStorage.setItem('agendamentos',JSON.stringify(agendamentos));
        showToast('Agendamento solicitado!','success');
        mostrarSalas();
    });
}

function mostrarAgendamentos(){
    titulo.textContent='Meus agendamentos';
    descricao.textContent='Veja o status dos seus agendamentos.';
    const meus=agendamentos.filter(a=>a.usuario===loggedUser.name),
          pendentes=meus.filter(a=>a.status==='pendente'),
          confirmados=meus.filter(a=>a.status==='confirmado');
    content.innerHTML=`<div class="panel">
        <h3>Pendentes</h3>
        ${pendentes.length?pendentes.map(a=>`<p>Sala ${a.numero} • ${a.data} ${a.inicio} - ${a.fim}</p>`).join(''):'<p class="muted">Nenhum agendamento pendente.</p>'}
        <h3 style="margin-top:12px">Confirmados</h3>
        ${confirmados.length?confirmados.map(a=>`<p>Sala ${a.numero} • ${a.data} ${a.inicio} - ${a.fim}</p>`).join(''):'<p class="muted">Nenhum agendamento confirmado.</p>'}
    </div>`;
}

function mostrarConta(){
    titulo.textContent='Minha conta';
    descricao.textContent='Seus dados de usuário.';
    content.innerHTML=`<div class="panel">
        <p><strong>Nome:</strong> ${loggedUser.name}</p>
        <p><strong>Email:</strong> ${loggedUser.email}</p>
        <p><strong>Cargo:</strong> Usuário</p>
    </div>`;
}

btnSalas.addEventListener('click',()=>{atualizarMenu(btnSalas);mostrarSalas();});
btnAgend.addEventListener('click',()=>{atualizarMenu(btnAgend);mostrarAgendamentos();});
btnConta.addEventListener('click',()=>{atualizarMenu(btnConta);mostrarConta();});
logoutBtn.addEventListener('click',()=>{sessionStorage.removeItem('loggedUser');window.location.href='index.html';});

mostrarSalas();
</script>
</body>
</html>
